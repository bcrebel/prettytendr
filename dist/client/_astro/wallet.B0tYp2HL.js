import{c as m,g as B}from"./index.RYns6xqu.js";import{a as O}from"./message.4NwmM3Ni.js";var K={exports:{}};(function(N,Y){(function(c,E){N.exports=E()})(m,()=>(()=>{var c,E,l={d:(e,s)=>{for(var r in s)l.o(s,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:s[r]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s),r:e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},C={};l.r(C),l.d(C,{WatchWalletChanges:()=>L,default:()=>f,getAddress:()=>I,getNetwork:()=>M,getNetworkDetails:()=>h,isAllowed:()=>y,isBrowser:()=>a,isConnected:()=>p,requestAccess:()=>P,setAllowed:()=>k,signAuthEntry:()=>D,signMessage:()=>g,signTransaction:()=>U}),function(e){e.CREATE_ACCOUNT="CREATE_ACCOUNT",e.FUND_ACCOUNT="FUND_ACCOUNT",e.ADD_ACCOUNT="ADD_ACCOUNT",e.IMPORT_ACCOUNT="IMPORT_ACCOUNT",e.IMPORT_HARDWARE_WALLET="IMPORT_HARDWARE_WALLET",e.LOAD_ACCOUNT="LOAD_ACCOUNT",e.MAKE_ACCOUNT_ACTIVE="MAKE_ACCOUNT_ACTIVE",e.UPDATE_ACCOUNT_NAME="UPDATE_ACCOUNT_NAME",e.GET_MNEMONIC_PHRASE="GET_MNEMONIC_PHRASE",e.CONFIRM_MNEMONIC_PHRASE="CONFIRM_MNEMONIC_PHRASE",e.CONFIRM_MIGRATED_MNEMONIC_PHRASE="CONFIRM_MIGRATED_MNEMONIC_PHRASE",e.RECOVER_ACCOUNT="RECOVER_ACCOUNT",e.CONFIRM_PASSWORD="CONFIRM_PASSWORD",e.REJECT_ACCESS="REJECT_ACCESS",e.GRANT_ACCESS="GRANT_ACCESS",e.SIGN_TRANSACTION="SIGN_TRANSACTION",e.SIGN_BLOB="SIGN_BLOB",e.SIGN_AUTH_ENTRY="SIGN_AUTH_ENTRY",e.HANDLE_SIGNED_HW_TRANSACTION="HANDLE_SIGNED_HW_TRANSACTION",e.REJECT_TRANSACTION="REJECT_TRANSACTION",e.SIGN_FREIGHTER_TRANSACTION="SIGN_FREIGHTER_TRANSACTION",e.SIGN_FREIGHTER_SOROBAN_TRANSACTION="SIGN_FREIGHTER_SOROBAN_TRANSACTION",e.ADD_RECENT_ADDRESS="ADD_RECENT_ADDRESS",e.LOAD_RECENT_ADDRESSES="LOAD_RECENT_ADDRESSES",e.SIGN_OUT="SIGN_OUT",e.SHOW_BACKUP_PHRASE="SHOW_BACKUP_PHRASE",e.SAVE_ALLOWLIST="SAVE_ALLOWLIST",e.SAVE_SETTINGS="SAVE_SETTINGS",e.SAVE_EXPERIMENTAL_FEATURES="SAVE_EXPERIMENTAL_FEATURES",e.LOAD_SETTINGS="LOAD_SETTINGS",e.GET_CACHED_ASSET_ICON="GET_CACHED_ASSET_ICON",e.CACHE_ASSET_ICON="CACHE_ASSET_ICON",e.GET_CACHED_ASSET_DOMAIN="GET_CACHED_ASSET_DOMAIN",e.CACHE_ASSET_DOMAIN="CACHE_ASSET_DOMAIN",e.GET_BLOCKED_ACCOUNTS="GET_BLOCKED_ACCOUNTS",e.GET_BLOCKED_DOMAINS="GET_BLOCKED_DOMAINS",e.ADD_CUSTOM_NETWORK="ADD_CUSTOM_NETWORK",e.CHANGE_NETWORK="CHANGE_NETWORK",e.REMOVE_CUSTOM_NETWORK="REMOVE_CUSTOM_NETWORK",e.EDIT_CUSTOM_NETWORK="EDIT_CUSTOM_NETWORK",e.RESET_EXP_DATA="RESET_EXP_DATA",e.ADD_TOKEN_ID="ADD_TOKEN_ID",e.GET_TOKEN_IDS="GET_TOKEN_IDS",e.REMOVE_TOKEN_ID="REMOVE_TOKEN_ID",e.GET_MIGRATABLE_ACCOUNTS="GET_MIGRATABLE_ACCOUNTS",e.GET_MIGRATED_MNEMONIC_PHRASE="GET_MIGRATED_MNEMONIC_PHRASE",e.MIGRATE_ACCOUNTS="MIGRATE_ACCOUNTS",e.ADD_ASSETS_LIST="ADD_ASSETS_LIST",e.MODIFY_ASSETS_LIST="MODIFY_ASSETS_LIST"}(c||(c={})),function(e){e.REQUEST_ACCESS="REQUEST_ACCESS",e.REQUEST_PUBLIC_KEY="REQUEST_PUBLIC_KEY",e.SUBMIT_TRANSACTION="SUBMIT_TRANSACTION",e.SUBMIT_BLOB="SUBMIT_BLOB",e.SUBMIT_AUTH_ENTRY="SUBMIT_AUTH_ENTRY",e.REQUEST_NETWORK="REQUEST_NETWORK",e.REQUEST_NETWORK_DETAILS="REQUEST_NETWORK_DETAILS",e.REQUEST_CONNECTION_STATUS="REQUEST_CONNECTION_STATUS",e.REQUEST_ALLOWED_STATUS="REQUEST_ALLOWED_STATUS",e.SET_ALLOWED_STATUS="SET_ALLOWED_STATUS",e.REQUEST_USER_INFO="REQUEST_USER_INFO"}(E||(E={}));const _=e=>{const s=Date.now()+Math.random();return window.postMessage({source:"FREIGHTER_EXTERNAL_MSG_REQUEST",messageId:s,...e},window.location.origin),new Promise(r=>{let n=0;e.type!==E.REQUEST_CONNECTION_STATUS&&e.type!==E.REQUEST_PUBLIC_KEY||(n=setTimeout(()=>{r({isConnected:!1,publicKey:""}),window.removeEventListener("message",t)},2e3));const t=T=>{var o,A;T.source===window&&((o=T?.data)===null||o===void 0?void 0:o.source)==="FREIGHTER_EXTERNAL_MSG_RESPONSE"&&((A=T?.data)===null||A===void 0?void 0:A.messagedId)===s&&(r(T.data),window.removeEventListener("message",t),clearTimeout(n))};window.addEventListener("message",t,!1)})},i={code:-1,message:"Node environment is not supported"},R={code:-1,message:"The wallet encountered an internal error. Please try again or contact the wallet if the problem persists."},w=async()=>{let e;try{e=await _({type:E.REQUEST_PUBLIC_KEY})}catch(s){console.error(s)}return{publicKey:e?.publicKey||"",error:e?.apiError}},u=async()=>{let e;try{e=await _({type:E.REQUEST_NETWORK_DETAILS})}catch(A){console.error(A)}const{networkDetails:s,apiError:r}=e||{networkDetails:{network:"",networkName:"",networkUrl:"",networkPassphrase:"",sorobanRpcUrl:void 0,apiError:""}},{network:n,networkUrl:t,networkPassphrase:T,sorobanRpcUrl:o}=s;return{network:n,networkUrl:t,networkPassphrase:T,sorobanRpcUrl:o,error:r}},I=async()=>{let e="";if(a){const s=await w();return e=s.publicKey,s.error?{address:e,error:s.error}:{address:e}}return{address:e,error:i}},U=async(e,s)=>{if(a){const r=await(async(n,t,T)=>{let o,A="",S="",d="";typeof t=="object"?(S=t.accountToSign||"",d=t.networkPassphrase||""):(A=t||"",S="");try{o=await _({transactionXdr:n,network:A,networkPassphrase:d,accountToSign:S,type:E.SUBMIT_TRANSACTION})}catch{return{signedTransaction:"",signerAddress:"",error:R}}const{signedTransaction:H,signerAddress:W}=o;return{signedTransaction:H,signerAddress:W,error:o?.apiError}})(e,s);return r.error?{signedTxXdr:"",signerAddress:"",error:r.error}:{signedTxXdr:r.signedTransaction,signerAddress:r.signerAddress}}return{signedTxXdr:"",signerAddress:"",error:i}},g=async(e,s)=>{if(a){const r=await(async(n,t)=>{let T;const o=(t||{}).address||"";try{T=await _({blob:n,accountToSign:o,type:E.SUBMIT_BLOB})}catch{return{signedMessage:null,signerAddress:"",error:R}}const{signedBlob:A,signerAddress:S}=T;return{signedMessage:A||null,signerAddress:S,error:T?.apiError}})(e,s);return r.error?{signedMessage:null,signerAddress:"",error:r.error}:{signedMessage:r.signedMessage,signerAddress:r.signerAddress}}return{signedMessage:null,signerAddress:"",error:i}},D=async(e,s)=>{if(a){const r=await(async(n,t)=>{const T=(t||{}).address||"";let o;try{o=await _({entryXdr:n,accountToSign:T,networkPassphrase:t?.networkPassphrase,type:E.SUBMIT_AUTH_ENTRY})}catch(d){return console.error(d),{signedAuthEntry:null,signerAddress:"",error:R}}const{signedAuthEntry:A,signerAddress:S}=o;return{signedAuthEntry:A||null,signerAddress:S,error:o?.apiError}})(e,s);return r.error?{signedAuthEntry:null,signerAddress:"",error:r.error}:{signedAuthEntry:r.signedAuthEntry,signerAddress:r.signerAddress}}return{signedAuthEntry:null,signerAddress:"",error:i}},p=async()=>a?window.freighter?Promise.resolve({isConnected:window.freighter}):(async()=>{let e={isConnected:!1};try{e=await _({type:E.REQUEST_CONNECTION_STATUS})}catch(s){console.error(s)}return{isConnected:e.isConnected}})():{isConnected:!1,error:i},M=async()=>{if(a){const e=await(async()=>{let s;try{s=await _({type:E.REQUEST_NETWORK_DETAILS})}catch(n){console.error(n)}const{networkDetails:r}=s||{networkDetails:{network:"",networkPassphrase:""}};return{network:r?.network,networkPassphrase:r?.networkPassphrase,error:s?.apiError}})();return e.error?{network:"",networkPassphrase:"",error:e.error}:{network:e.network,networkPassphrase:e.networkPassphrase}}return{network:"",networkPassphrase:"",error:i}},h=async()=>{if(a){const e=await u();return e.error?{network:"",networkUrl:"",networkPassphrase:"",error:e.error}:{network:e.network,networkUrl:e.networkUrl,networkPassphrase:e.networkPassphrase,sorobanRpcUrl:e.sorobanRpcUrl}}return{network:"",networkUrl:"",networkPassphrase:"",error:i}},y=async()=>{let e=!1;if(a){const s=await(async()=>{let r;try{r=await _({type:E.REQUEST_ALLOWED_STATUS})}catch(t){console.error(t)}const{isAllowed:n}=r||{isAllowed:!1};return{isAllowed:n,error:r?.apiError}})();return e=s.isAllowed,s.error?{isAllowed:e,error:s.error}:{isAllowed:e}}return{isAllowed:e,error:i}},k=async()=>{let e=!1;if(a){const s=await(async()=>{let r;try{r=await _({type:E.SET_ALLOWED_STATUS})}catch(t){console.error(t)}const{isAllowed:n}=r||{isAllowed:!1};return{isAllowed:n,error:r?.apiError}})();return e=s.isAllowed,s.error?{isAllowed:e,error:s.error}:{isAllowed:e}}return{isAllowed:e,error:i}},P=async()=>{let e="";if(a){const s=await(async()=>{let r;try{r=await _({type:E.REQUEST_ACCESS})}catch(t){console.error(t)}const{publicKey:n}=r||{publicKey:""};return{publicKey:n,error:r?.apiError}})();return e=s.publicKey,s.error?{address:e,error:s.error}:{address:e}}return{address:e,error:i}};class L{constructor(s=3e3){this.fetchInfo=async r=>{if(!this.isRunning)return;const n=await w(),t=await u();(n.error||t.error)&&r({address:"",network:"",networkPassphrase:"",error:n.error||t.error}),this.currentAddress===n.publicKey&&this.currentNetwork===t.network&&this.currentNetworkPassphrase===t.networkPassphrase||(this.currentAddress=n.publicKey,this.currentNetwork=t.network,this.currentNetworkPassphrase=t.networkPassphrase,r({address:n.publicKey,network:t.network,networkPassphrase:t.networkPassphrase})),setTimeout(()=>this.fetchInfo(r),this.timeout)},this.timeout=s,this.currentAddress="",this.currentNetwork="",this.currentNetworkPassphrase="",this.isRunning=!1}watch(s){return a?(this.isRunning=!0,this.fetchInfo(s),{}):{error:i}}stop(){this.isRunning=!1}}const a=typeof window<"u",f={getAddress:I,signTransaction:U,signMessage:g,signAuthEntry:D,isConnected:p,getNetwork:M,getNetworkDetails:h,isAllowed:y,setAllowed:k,requestAccess:P,WatchWalletChanges:L};return C})())})(K);var v=K.exports;const b=B(v),{isAllowed:Q,getAddress:F,isConnected:V}=b,G=O(!0),x=O(!1),X=O("");if(!await V())G.set(!1);else if(await Q()){let{address:N}=await F();x.set(!0),X.set(N),setTimeout(()=>G.set(!1),500)}export{x as _,b as a,X as p,G as w};
